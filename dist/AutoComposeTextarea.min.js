!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.AutoComposeTextarea=e()}(this,function(){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t=function(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t};function s(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function r(t,e,n){if(e="autosuggest_"+e,void 0===n)return void 0!==(n=t.dataset[e])?JSON.parse(t.dataset[e]):n;t.dataset[e]=JSON.stringify(n)}function y(t){var e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}var h=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],s=!0,o=!1,i=void 0;try{for(var r,p=t[Symbol.iterator]();!(s=(r=p.next()).done)&&(n.push(r.value),!e||n.length!==e);s=!0);}catch(t){o=!0,i=t}finally{try{!s&&p.return&&p.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=function(t){return[t.selectionStart,t.selectionEnd].sort(function(t,e){return t-e})},c="\ufeff",g=["fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize","whiteSpace","wordWrap","wordBreak"],v=[].concat(g,["direction","boxSizing","borderRightWidth","borderLeftWidth","paddingRight","paddingLeft"]),f=[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(v),["width","overflowX","overflowY","borderTopWidth","borderBottomWidth","borderStyle","paddingTop","paddingBottom","lineHeight"]),m=function(t){for(var e=t,n=0,s=0;s+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;);return{left:s,top:n}},C=void 0,p=(t(e,[{key:"show",value:function(t,e){var n=this;if(t){var s=m(e),o=window.getComputedStyle(e);v.forEach(function(t){n.host.style[t]=o[t]}),this.host.style.left=s.left+"px",this.host.style.top=t.top+"px",this.host.style.height=parseFloat(o.height)-t.top+s.top+"px",this.host.style.color=o.color;var i=parseFloat(o.width)-C;this.host.style.width=i+"px";var r=t.left-s.left-parseFloat(o.paddingLeft||0),p=i-t.left+s.left-parseFloat(o.paddingRight||0),a=0;a="ltr"===o.direction?(this.offset.style.float="left",this.offset.style.width=r+"px",p):(this.offset.style.float="right",this.offset.style.width=p+"px",r);var l=document.createElement("span");l.style.whiteSpace="nowrap",g.forEach(function(t){l.style[t]=o[t]}),l.appendChild(y("<span>&nbsp;</span>")),l.firstChild.style.fontSize="1px";var d=document.createTextNode("");l.appendChild(d),document.body.appendChild(l);for(var h=!1,u=-1,c=this.suggestion.length,f=0;f<c;f++){if(!h&&(/\s/.test(this.suggestion[f])&&(u=f),d.nodeValue+=this.suggestion[f],h=a<l.offsetWidth))for(var b=u+2;b<=f;b++)this.content.childNodes[b].style.lineHeight=o.lineHeight;h&&(this.content.childNodes[f+1].style.lineHeight=o.lineHeight)}h&&(this.content.lastChild.style.lineHeight=o.lineHeight),document.body.removeChild(l)}this.host.style.display="block",this.isActive=!0}},{key:"hide",value:function(){this.host.style.display="none",this.isActive=!1}},{key:"empty",value:function(){for(this.isEmpty=!0;this.content.firstChild;)this.content.removeChild(this.content.firstChild)}},{key:"fill",value:function(s,o){var i=this;this.empty(),this.suggestion=s,this.content.appendChild(y("<span>&nbsp;</span>")),this.content.firstChild.style.fontSize="1px",s.split("").concat(" &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;").forEach(function(t,e){var n=y("<span>"+t+"</span>");n.style.opacity=.7,n.style.lineHeight=1.5,n.style.pointerEvents="all",i.content.appendChild(n),n.addEventListener("mousedown",function(t){o(s.slice(0,e+1)),i.hide(),t.preventDefault(),t.stopPropagation()})}),this.isEmpty=!1}},{key:"getValue",value:function(){return this.suggestion}}]),e);function e(){o(this,e),void 0===C&&(C=function(){var t=document.createElement("div");t.style.visibility="hidden",t.style.overflow="scroll",t.style.msOverflowStyle="scrollbar",document.body.appendChild(t);var e=document.createElement("div");t.appendChild(e);var n=t.offsetWidth-e.offsetWidth;return t.parentNode.removeChild(t),n}()),this.isEmpty=!0,this.isActive=!1,this.suggestion="",this.host=document.createElement("div"),this.host.className="autocompose-overlay-suggestion",this.host.style.zIndex=9999,this.host.style.cursor="text",this.host.style.position="absolute",this.host.style.borderColor="transparent",this.host.style.backgroundColor="transparent",this.host.style.overflow="hidden",this.host.style.pointerEvents="none",this.offset=document.createElement("div"),this.offset.appendChild(document.createTextNode(c)),this.offset.style.lineHeight=1.5,this.content=document.createElement("div"),this.content.style.lineHeight="1px",this.hide(),document.body.appendChild(this.host),this.host.appendChild(this.offset),this.host.appendChild(this.content)}function b(t){var e=t.element,n=t.suggestion,s=t.fullSuggestion,o=t.onChange,i=u(e),r=h(i,1)[0],p=e.value,a=p.slice(0,r)+n;e.value=a+p.slice(r),e.focus();var l=a.length;e.setSelectionRange(l,l),o({suggestion:s,acceptedSuggestion:n})}function w(t){if(o(this,w),!t)throw Error("AutoCompose Textarea: Missing required parameter, options");"function"==typeof t&&(t={composer:t}),this.inputs=[],this.suggestion=new p,this.onChange=t.onChange||Function.prototype,this.onReject=t.onReject||Function.prototype,function(e,n,t){[].concat(t).forEach(function(t){if(void 0===n[t])throw Error("AutoCompose: Missing required parameter, "+e+"."+t)})}("AutoCompose Textarea",t,"composer"),function(n,t,s,o){[].concat(t[s]).forEach(function(t){var e=void 0===t?"undefined":i(t);if(e!==o&&"undefined"!==e)throw new TypeError("AutoCompose: Invalid Type for "+n+"."+s+", expected "+o)})}("AutoCompose Textarea",t,"composer","function"),this.composer=t.composer;var a=this,l=!1;this.onBlurHandler=function(){a.suggestion.hide()},this.onKeyDownHandler=function(t){if(a.suggestion.isActive&&(9===t.keyCode||39===t.keyCode||40===t.keyCode)){var e=a.suggestion.getValue();b({element:this,fullSuggestion:e,suggestion:e,onChange:a.onChange.bind(this)}),a.suggestion.hide(),l=!0,t.preventDefault()}};var d=0;this.onKeyUpHandler=function(t){var n=this;if(l)l=!1;else{a.suggestion.isActive&&(a.suggestion.hide(),a.onReject({suggestion:a.suggestion.getValue()}));var e=u(this),s=h(e,2),o=s[0];if(o===s[1])if(!this.value.slice(o).trim()){var i=this.value.slice(0,o);d++;var r,p=function(t){var e=u(t),n=h(e,1)[0],s=document.createElement("pre");s.id="autocompose-positionclone";var o=document.createElement("span");o.appendChild(document.createTextNode(c));var i=window.getComputedStyle(t);f.forEach(function(t){s.style[t]=i[t]});var r=m(t);s.style.opacity=0,s.style.position="absolute",s.style.top=r.top+"px",s.style.left=r.left+"px",document.body.appendChild(s),s.style.overflowY=parseInt(i.height)<t.scrollHeight?"scroll":"hidden",s.appendChild(document.createTextNode(t.value.slice(0,n))),s.appendChild(o),s.style.maxWidth="100%";var p=m(o);return p.top-=t.scrollTop,p.left-=t.scrollLeft,document.body.removeChild(s),p}(this);r=d,a.composer.call(n,i,function(e){e&&r===d&&(a.suggestion.fill(e,function(t){b({element:n,suggestion:t,fullSuggestion:e,onChange:a.onChange.bind(n)})}),a.suggestion.show(p,n))})}}};for(var e=arguments.length,n=Array(1<e?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];this.addInputs.apply(this,n)}return t(w,[{key:"addInputs",value:function(){for(var e=this,t=arguments.length,n=Array(t),s=0;s<t;s++)n[s]=arguments[s];Array.prototype.concat.apply([],n.map(function(t){return t[0]?Array.prototype.slice.call(t,0):t})).forEach(function(t){if("TEXTAREA"!==t.tagName)throw Error("AutoCompose Textarea: Invalid input: only textarea elements are supported");t.addEventListener("blur",e.onBlurHandler),t.addEventListener("keyup",e.onKeyUpHandler),t.addEventListener("mouseup",e.onKeyUpHandler),t.addEventListener("keydown",e.onKeyDownHandler,!0),r(t,"index",e.inputs.push(t)-1)})}},{key:"removeInputs",value:function(){for(var n=this,t=arguments.length,e=Array(t),s=0;s<t;s++)e[s]=arguments[s];Array.prototype.concat.apply([],e.map(function(t){return t[0]?Array.prototype.slice.call(t,0):t})).forEach(function(t){var e=r(t,"index");isNaN(e)||(n.inputs.splice(e,1),t.removeEventListener("blur",n.onBlurHandler),t.removeEventListener("keyup",n.onKeyUpHandler),t.removeEventListener("mouseup",n.onKeyUpHandler),t.removeEventListener("keydown",n.onKeyDownHandler,!0))})}},{key:"destroy",value:function(){this.removeInputs(this.inputs)}}]),w});
